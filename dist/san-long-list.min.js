!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("san")):"function"==typeof define&&define.amd?define(["san"],e):(t=t||self).LongList=e(t.san)}(this,function(o){"use strict";function i(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}return function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,s(e).apply(this,arguments))}var a,r,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,o.Component),a=e,(r=[{key:"initData",value:function(){return{datasource:[],curds:[],keeps:5,radius:30,buffer:4,wStyle:{"overflow-y":"scroll"},fixHeight:null,stopScroll:!0,iStyle:{},threshold:300,lHeight:function(t,e,a){return t*a+"px"},enable:!0}}},{key:"inited",value:function(){var e=this;this.watch("datasource",function(t){return e.onDatasourceUpdate(t)}),this.watch("lStyle",function(t){return e.data.merge("wStyle",t)});var t=this.data.get("lStyle");t&&this.data.merge("wStyle",t)}},{key:"attached",value:function(){this._repaintChildren();var t=this.data.get(),e=t.threshold,a=t.buffer,r=t.datasource;e||this.data.set("threshold",2*a+1),this.onDatasourceUpdate(r)}},{key:"onScroll",value:function(t){if(this.data.get("enable")){var e=t.target.scrollTop,a=this.data.get(),r=a.size,n=a.buffer,o=this.data.get("cache")||0;if(!(Math.abs(o-e)<=n*r)){var i=e%r,s=Math.floor(e/r);this.data.set("cache",e),this.update(s,i)}}}},{key:"update",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=this.data.get(),r=a.datasource,n=a.radius,o=a.keeps,i=a.size;o="number"==typeof o?o:0;for(var s=[],l=t-n;l<t+n+o;l++)l<0||l>=r.length||s.push(r[l]);this.data.set("curds",s);var u=(t-(n+1))*i+e,c={"padding-top":u+"px","padding-bottom":r.length*i-u-(2*n+o)*i+"px"};this.data.merge("iStyle",c)}},{key:"onDatasourceUpdate",value:function(t){this.ref("scroller").scrollTop=0;var e=this.data.get("threshold");t.length<=e?(this.data.set("curds",t),this.data.merge("iStyle",{"padding-top":0,"padding-bottom":0}),this.data.set("enable",!1)):(this.data.set("enable",!0),this.update(0,0))}},{key:"onWheel",value:function(t){if(this.data.get("stopScroll")){var e=t.currentTarget;e&&(e.scrollTop+t.deltaY+e.clientHeight>=e.scrollHeight&&(t.preventDefault(),e.scrollTop=e.scrollHeight),e.scrollTop+t.deltaY<=0&&(t.preventDefault(),e.scrollTop=0))}}},{key:"template",get:function(){return'\n        <template>\n            <div s-ref="scroller" class="{{lClass}}" style="{{wStyle}}" on-scroll="onScroll" on-wheel="onWheel">\n                <div style="{{iStyle}}" class="{{iClass}}">\n                    <slot s-for="i in curds" var-item="{{i}}"/>\n                </div>\n            </div>\n        </template>'}},{key:"dataTypes",get:function(){return{stopScroll:o.DataTypes.bool,keeps:o.DataTypes.number,radius:o.DataTypes.number,buffer:o.DataTypes.number,size:o.DataTypes.number.isRequired,lHeight:o.DataTypes.func,lStyle:o.DataTypes.object,lClass:o.DataTypes.array,iStyle:o.DataTypes.object,iClass:o.DataTypes.array,threshold:o.DataTypes.number}}},{key:"computed",get:function(){return{"wStyle.height":function(){var t=this.data.get("keeps"),e=this.data.get("size"),a=this.data.get("datasource").length,r=this.data.get("lHeight");if("function"!=typeof r)throw new TypeError("(from LongList)lHeight should be a function.");return r(t,a,e)}}}}])&&i(a.prototype,r),n&&i(a,n),e}()});
